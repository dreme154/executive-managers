<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="output.css" />
    <link rel="shortcut icon" href="images/logo.png" type="image/x-icon">
    <title>Contact Management</title>
  </head>
  <body class="font-inter relative bg-slate-50">
    
    <!-- Navbar -->
    <div class="bg-slate-200 border-y border-gray-300 sticky top-0 z-20 p-3 flex items-center justify-between">
      <span class="block w-36"><img src="images/logo.png" alt="Logo"></span>
      <a href="index.html" class="text-blue-700 hover:underline text-sm">Back to Home</a>
    </div>

    <!-- Contact Form -->
    <form class="max-w-md mt-5 mx-2 md:mx-auto bg-white p-6 rounded-lg shadow-lg space-y-4 border border-gray-200">
      <h2 class="text-2xl font-bold text-blue-700 mb-4 text-center">Contact Management</h2>

      <!-- Reason -->
      <div>
        <label for="reason" class="block text-sm font-medium text-blue-700">Reason</label>
        <input 
          type="text" 
          id="reason"
          placeholder="Reason for contacting support"
          class="mt-1 block w-full px-2 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
        />
      </div>

      <!-- Fan Name -->
      <div>
        <label for="fan-name" class="block text-sm font-medium text-blue-700">Fan Name</label>
        <input 
          type="text" 
          id="fan-name" 
          placeholder="Enter your name"
          class="mt-1 block w-full px-2 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
        />
        <p class="text-sm text-red-600 ml-2"></p>
      </div>

      <!-- Email -->
      <div>
        <label for="email" class="block text-sm font-medium text-blue-700">Email</label>
        <input 
          type="text" 
          id="email" 
          placeholder="Enter your email"
          class="mt-1 block w-full px-2 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
        />
        <p class="text-sm text-red-600 ml-2"></p>
      </div>

      <!-- Phone Number -->
      <div>
        <label for="phone-number" class="block text-sm font-medium text-blue-700">Phone Number</label>
        <input 
          type="text" 
          id="phone-number" 
          placeholder="Enter phone number"
          class="mt-1 block w-full px-2 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
        />
        <p class="text-sm text-red-600 ml-2"></p>
      </div>

      <!-- Address -->
      <div>
        <label for="address" class="block text-sm font-medium text-blue-700">Address</label>
        <input 
          type="text" 
          id="address" 
          placeholder="Enter your address"
          class="mt-1 block w-full px-2 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
        />
        <p class="text-sm text-red-600 ml-2"></p>
      </div>

      <!-- Membership ID -->
      <div>
        <label for="membership-id" class="block text-sm font-medium text-blue-700">Membership ID</label>
        <input 
          type="text" 
          id="membership-id" 
          placeholder="Enter membership ID"
          class="mt-1 block w-full px-2 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
        />
        <p class="text-sm text-red-600 ml-2"></p>
      </div>

      <!-- Button -->
      <button id="send-request-btn" class="mt-4 w-full text-white bg-blue-700 px-6 py-3 rounded-xl hover:bg-blue-900 text-base font-medium">
        Send
      </button>
    </form>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="hidden fixed inset-0 items-center justify-center bg-black bg-opacity-50 z-30">
      <div class="flex flex-col items-center bg-white px-4 py-6 rounded-lg shadow-lg">
        <img src="images/spinner.png" alt="Loading" class="w-12 h-12 animate-spin">
        <p class="text-blue-700 mt-3 font-medium text-sm">Processing, please wait...</p>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-200 py-6 mt-12">
      <div class="container mx-auto px-6 flex flex-col items-start sm:flex-row justify-between space-y-4 sm:space-y-0">

        <!-- Logo -->
        <div class="flex items-center justify-start space-x-4">
          <img src="images/logo.png" alt="Executive Managers Logo" class="w-44 h-auto">
        </div>

        <!-- Quick Links -->
        <div class="flex flex-col sm:flex-row space-y-1 ml-2 sm:space-y-0 sm:space-x-6 text-blue-700 tracking-normal">
          <a href="celebs.html" class="hover:text-blue-900">Celebrities</a>
          <a href="membership.html" class="hover:text-blue-900">Membership Card</a>
          <a href="pricing.html" class="hover:text-blue-900">Pricing</a>
          <a href="" class="hover:text-blue-900">Promotion</a>
          <a href="account.html" class="hover:text-blue-900">Account</a>
          <a href="settings.html" class="hover:text-blue-900">Settings</a>
        </div>

        <!-- Social Media Links -->
        <div class="flex space-x-3 text-blue-700 ml-2">
          <a href="#" class="hover:text-blue-900">
            <img src="images/facebook.png" alt="Facebook" class="w-8 h-8 outline outline-1 outline-slate-400 rounded-lg">
          </a>
          <a href="#" class="hover:text-blue-900">
            <img src="images/twitter.png" alt="Twitter" class="w-8 h-8 outline outline-1 outline-slate-400 rounded-lg">
          </a>
          <a href="#" class="hover:text-blue-900">
            <img src="images/instagram.png" alt="Instagram" class="w-8 h-8 outline outline-1 outline-slate-400 rounded-xl">
          </a>
          <a href="#" class="hover:text-blue-900">
            <img src="images/linkedin.png" alt="LinkedIn" class="w-8 h-8 outline outline-1 outline-slate-400 rounded-lg">
          </a>
        </div>
      </div>

      <!-- Copyright Section -->
      <div class="text-center mt-6 text-gray-800 text-sm mx-3 tracking-tight">
        <p>&copy; 2025 Executive Managers Inc. All rights reserved.</p>
      </div>
    </footer>    
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

    <script type="text/javascript">
      const urlParams = new URLSearchParams(window.location.search);
      const reason = urlParams.get('reason');
      let content = '';

      const loadingSpinner = document.getElementById('loading-spinner');
      const sendRequestBtn = document.getElementById('send-request-btn');
      const fanName = document.getElementById('fan-name');
      const phoneNumber = document.getElementById('phone-number');
      const membershipId = document.getElementById('membership-id');
      const address = document.getElementById('address');
      const email = document.getElementById('email');
      const reasonField = document.getElementById('reason');

      const formInputs = [fanName, phoneNumber, membershipId, address, reasonField]

      function autofillValues() {
        if (reason) { 
          reasonField.disabled = true;

          if (reason === 'priority-pass') {
            reasonField.value = 'Priority Pass';
            content = "I'm writing to request for a priority pass. Here are my details;";
          } else if (reason === 'security-clearance') {
            reasonField.value = 'Security Clearance';
            content = "I'm writing to request for a security clearance number. Here are my details;";
          } else if (reason === 'priority-activation') {
            reasonField.value = 'Priority Pass Activation';
            content = "Activation of my priority pass was declined. Here are my details;";
          }
        }
      };
      document.addEventListener('DOMContentLoaded', autofillValues);
      
      sendRequestBtn.addEventListener('click', (event) => {
        event.preventDefault();
        
        sendRequestBtn.disabled = true;

        for (let input of formInputs) {
          if (input.value === '') {
            input.nextElementSibling.innerHTML = 'This is a required field**'
            return;
          }
        };

        loadingSpinner.classList.remove('hidden');
        loadingSpinner.classList.add('flex');

        (function(){
          emailjs.init({
            publicKey: "LyADlt-ofiWngUQoQ",
          });
        })();

        const templateParams = {
          content,
          reason: reason.value,
          address: address.value,
          email: email.value,
          fan_name: fanName.value,
          membership_id: membershipId.value,
          phone_number: phoneNumber.value,
          date: new Date()
        };

        emailjs.send('service_q731n5c', 'template_wt1zcs2', templateParams)
          .then(() => {
            setTimeout(() => {
              if (reason === 'priority-pass') {
                window.location.href = `success.html?reason=priority-pass`
              } else if (reason === 'security-clearance') {
                window.location.href = `success.html?reason=security-clearance`
              } else if (reason === 'priority-activation') {
                window.location.href = `success.html?reason=priority-activation`
              };
            }, 500);
          })
          .catch((error) => {
            console.error('Failed to send email:', error);
            alert('Failed to send the email. Please try again.');
          })
          .finally(() => {
            loadingSpinner.classList.add('hidden');
            loadingSpinner.classList.remove('flex');
            sendRequestBtn.disabled = false;
          });
      });
    </script>
  </body>
</html>